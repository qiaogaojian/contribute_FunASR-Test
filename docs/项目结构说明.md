# é¡¹ç›®ç»“æ„é‡æ„è¯´æ˜

## ğŸ¯ é‡æ„ç›®æ ‡

å°†é¡¹ç›®é‡æ„ä¸ºç¬¦åˆPoetryåŒ…ç®¡ç†çš„æ ‡å‡†ç»“æ„ï¼Œæ‰€æœ‰å¯¼å…¥éƒ½ä»`src`å¼€å§‹ï¼Œä¸å†ä½¿ç”¨`sys.path.append`æ‰‹åŠ¨æ·»åŠ è·¯å¾„ï¼Œå¹¶ä¸”ä½¿ç”¨`./venv/python.exe`è§£é‡Šå™¨è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨`python`å‘½ä»¤ã€‚

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

```
FunASR-Online-Paraformer-Test/
â”œâ”€â”€ src/                               # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                   # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ asr/                          # ASRè¯­éŸ³è¯†åˆ«æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ streaming_paraformer.py   # ASRä¸»ç¨‹åº
â”‚   â”œâ”€â”€ asr_config.py                 # ASRé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config_switcher.py            # é…ç½®åˆ‡æ¢å·¥å…·
â”‚   â”œâ”€â”€ system_launcher.py            # ç³»ç»Ÿå¯åŠ¨å™¨
â”‚   â””â”€â”€ websocket_server.py           # WebSocketæœåŠ¡å™¨
â”œâ”€â”€ test/                             # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                   # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ test_frontend.py              # å‰ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_integrated_system.py     # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_asr_optimization.py      # ä¼˜åŒ–æ•ˆæœæµ‹è¯•
â”œâ”€â”€ frontend/                         # å‰ç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html                    # å‰ç«¯é¡µé¢
â”‚   â””â”€â”€ style.css                     # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ docs/                             # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ FunASR_ä¼˜åŒ–é…ç½®è¯´æ˜.md        # ä¼˜åŒ–é…ç½®è¯´æ˜
â”‚   â””â”€â”€ ä½¿ç”¨æŒ‡å—.md                   # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ run_system.py                     # ä¸»å¯åŠ¨è„šæœ¬
â”œâ”€â”€ switch_config.py                  # é…ç½®åˆ‡æ¢è„šæœ¬
â”œâ”€â”€ run_tests.py                      # æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ pyproject.toml                    # Poetryé…ç½®
â”œâ”€â”€ requirements.txt                  # pipä¾èµ–æ–‡ä»¶
â””â”€â”€ README.md                         # é¡¹ç›®è¯´æ˜
```

## ğŸ”„ ä¸»è¦å˜æ›´

### 1. æ–‡ä»¶ç§»åŠ¨

| åŸä½ç½® | æ–°ä½ç½® | è¯´æ˜ |
|--------|--------|------|
| `asr_config.py` | `src/asr_config.py` | é…ç½®æ–‡ä»¶ç§»åˆ°srcç›®å½• |
| `switch_asr_config.py` | `src/config_switcher.py` | é‡å‘½åå¹¶ç§»åŠ¨ |
| `start_asr_system.py` | `src/system_launcher.py` | é‡å‘½åå¹¶ç§»åŠ¨ |
| `test_*.py` | `test/test_*.py` | æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ç§»åˆ°testç›®å½• |

### 2. å¯¼å…¥è¯­å¥ä¿®æ”¹

**æ—§çš„å¯¼å…¥æ–¹å¼ï¼ˆä½¿ç”¨sys.path.appendï¼‰ï¼š**
```python
import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), '..', '..'))
from asr_config import get_config
```

**æ–°çš„å¯¼å…¥æ–¹å¼ï¼ˆä½¿ç”¨PoetryåŒ…ç»“æ„ï¼‰ï¼š**
```python
from src.asr_config import get_config
```

### 3. æ–°çš„å¯åŠ¨è„šæœ¬

#### ä¸»å¯åŠ¨è„šæœ¬ï¼š`run_system.py`
```bash
python run_system.py
```
- ä½¿ç”¨`./venv/python.exe`è§£é‡Šå™¨è¿è¡Œç³»ç»Ÿ
- è‡ªåŠ¨æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒè§£é‡Šå™¨
- åœ¨æ–°çª—å£å¯åŠ¨WebSocketæœåŠ¡å™¨

#### é…ç½®åˆ‡æ¢è„šæœ¬ï¼š`switch_config.py`
```bash
python switch_config.py meeting
```
- ç®€åŒ–çš„é…ç½®åˆ‡æ¢æ¥å£
- æ”¯æŒå‘½ä»¤è¡Œå‚æ•°

#### æµ‹è¯•è¿è¡Œè„šæœ¬ï¼š`run_tests.py`
```bash
python run_tests.py frontend
```
- ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œæ¥å£
- æ”¯æŒä¸åŒç±»å‹çš„æµ‹è¯•

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨Poetryï¼ˆæ¨èï¼‰
poetry install

# æˆ–ä½¿ç”¨pip
pip install -r requirements.txt
```

### 2. å¯åŠ¨ç³»ç»Ÿ

```bash
# ä¸€é”®å¯åŠ¨ï¼ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒè§£é‡Šå™¨ï¼‰
python run_system.py

# æˆ–åˆ†æ­¥å¯åŠ¨ï¼ˆæ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒè§£é‡Šå™¨ï¼‰
./venv/python.exe -m src.websocket_server
./venv/python.exe -m src.asr.streaming_paraformer

# æˆ–ä½¿ç”¨Poetry
poetry run python -m src.websocket_server
poetry run python -m src.asr.streaming_paraformer
```

### 3. åˆ‡æ¢é…ç½®

```bash
# äº¤äº’å¼åˆ‡æ¢
python switch_config.py

# å‘½ä»¤è¡Œåˆ‡æ¢
python switch_config.py meeting
```

### 4. è¿è¡Œæµ‹è¯•

```bash
# å‰ç«¯æµ‹è¯•
python run_tests.py frontend

# é›†æˆæµ‹è¯•
python run_tests.py integration

# ä¼˜åŒ–æµ‹è¯•
python run_tests.py optimization
```

## ğŸ“¦ Poetryé…ç½®

`pyproject.toml`æ–‡ä»¶é…ç½®äº†åŒ…ç»“æ„ï¼š

```toml
[tool.poetry]
name = "asr_service"
version = "0.1.0"
packages = [{include = "src", from="."}]

[tool.poetry.dependencies]
python = "^3.9"
websockets = "^12.0"
numpy = "^1.24.0"
sounddevice = "^0.4.6"
rich = "^13.0.0"
colorama = "^0.4.6"
soundfile = "^0.12.1"
```

## ğŸ”§ å¼€å‘è¯´æ˜

### æ¨¡å—å¯¼å…¥è§„åˆ™

1. **å†…éƒ¨æ¨¡å—å¯¼å…¥**ï¼šå§‹ç»ˆä½¿ç”¨`from src.module import ...`
2. **æµ‹è¯•æ¨¡å—å¯¼å…¥**ï¼šä½¿ç”¨`from test.module import ...`
3. **ä¸å†ä½¿ç”¨**ï¼š`sys.path.append`æ‰‹åŠ¨æ·»åŠ è·¯å¾„

### è¿è¡Œæ¨¡å—

#### ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒè§£é‡Šå™¨ï¼ˆæ¨èï¼‰
```bash
# è¿è¡ŒWebSocketæœåŠ¡å™¨
./venv/python.exe -m src.websocket_server

# è¿è¡ŒASRæœåŠ¡
./venv/python.exe -m src.asr.streaming_paraformer

# è¿è¡Œé…ç½®åˆ‡æ¢å·¥å…·
./venv/python.exe -m src.config_switcher

# è¿è¡Œæµ‹è¯•
./venv/python.exe -m test.test_frontend
```

#### ä½¿ç”¨Poetry
```bash
# è¿è¡ŒWebSocketæœåŠ¡å™¨
poetry run python -m src.websocket_server

# è¿è¡ŒASRæœåŠ¡
poetry run python -m src.asr.streaming_paraformer

# è¿è¡Œé…ç½®åˆ‡æ¢å·¥å…·
poetry run python -m src.config_switcher

# è¿è¡Œæµ‹è¯•
poetry run python -m test.test_frontend
```

## âœ… é‡æ„ä¼˜åŠ¿

1. **æ ‡å‡†åŒ–ç»“æ„**ï¼šç¬¦åˆPythonåŒ…ç®¡ç†æœ€ä½³å®è·µ
2. **æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»**ï¼šæºä»£ç ã€æµ‹è¯•ã€æ–‡æ¡£åˆ†ç¦»
3. **ç®€åŒ–çš„å¯¼å…¥**ï¼šä¸å†éœ€è¦æ‰‹åŠ¨è·¯å¾„ç®¡ç†
4. **Poetryé›†æˆ**ï¼šæ›´å¥½çš„ä¾èµ–ç®¡ç†å’Œè™šæ‹Ÿç¯å¢ƒ
5. **æ˜“äºç»´æŠ¤**ï¼šæ¸…æ™°çš„é¡¹ç›®ç»“æ„ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ”„ è¿ç§»æŒ‡å—

å¦‚æœæ‚¨æœ‰è‡ªå®šä¹‰çš„è„šæœ¬æˆ–é…ç½®ï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹å¼æ›´æ–°ï¼š

1. **æ›´æ–°å¯¼å…¥è¯­å¥**ï¼šå°†æ‰€æœ‰`from module`æ”¹ä¸º`from src.module`
2. **æ›´æ–°è¿è¡Œå‘½ä»¤**ï¼šä½¿ç”¨`poetry run python -m src.module`
3. **æ›´æ–°æµ‹è¯•**ï¼šå°†æµ‹è¯•æ–‡ä»¶ç§»åˆ°`test/`ç›®å½•
4. **æ›´æ–°æ–‡æ¡£**ï¼šå‚è€ƒæ–°çš„é¡¹ç›®ç»“æ„

## ğŸ†˜ æ•…éšœæ’é™¤

### å¯¼å…¥é”™è¯¯
å¦‚æœé‡åˆ°å¯¼å…¥é”™è¯¯ï¼Œè¯·ç¡®ä¿ï¼š
1. å·²å®‰è£…Poetryï¼š`poetry --version`
2. å·²å®‰è£…ä¾èµ–ï¼š`poetry install`
3. ä½¿ç”¨æ­£ç¡®çš„è¿è¡Œå‘½ä»¤ï¼š`poetry run python -m src.module`

### æ¨¡å—æœªæ‰¾åˆ°
å¦‚æœæç¤ºæ¨¡å—æœªæ‰¾åˆ°ï¼š
1. æ£€æŸ¥`pyproject.toml`ä¸­çš„packagesé…ç½®
2. ç¡®ä¿æ‰€æœ‰ç›®å½•éƒ½æœ‰`__init__.py`æ–‡ä»¶
3. ä½¿ç”¨`poetry run`å‰ç¼€è¿è¡Œå‘½ä»¤
