# FunASR 实时语音转文字前端使用指南

## 快速开始

### 1. 安装依赖

```bash
# 安装WebSocket依赖
pip install websockets

# 或者使用requirements.txt安装所有依赖
pip install -r requirements.txt
```

### 2. 启动系统

#### 方法一：一键启动（推荐）

**Windows批处理脚本（最简单）：**
```bash
start_asr_system.bat
```

**PowerShell脚本：**
```powershell
.\start_asr_system.ps1
```

**Python脚本：**
```bash
python start_asr_system.py
```

这将自动：
- ✅ 激活虚拟环境
- 🚀 启动WebSocket服务器
- 🎤 启动ASR语音识别服务
- 🌐 打开前端页面

#### 方法二：分步启动

**步骤1：激活虚拟环境**
```bash
micromamba activate ./venv
```

**步骤2：启动WebSocket服务器**
```bash
python src/websocket_server.py
```

**步骤3：启动ASR程序**
```bash
python src/asr/streaming_paraformer.py
```

**步骤4：打开前端页面**
- 双击打开 `frontend/index.html`
- 或在浏览器中打开该文件

### 3. 测试系统

#### 完整系统测试
```bash
python test_integrated_system.py
```

#### 单独测试前端显示
如果想测试前端显示效果而不启动ASR程序：

```bash
# 启动WebSocket服务器
python src/websocket_server.py

# 在另一个终端运行测试脚本
python test_frontend.py
```

## 详细使用说明

### 界面介绍

#### 顶部状态栏
- **🟢 绿色圆点**: 已连接到WebSocket服务器
- **🔴 红色圆点**: 连接断开或出错
- **🟠 橙色圆点**: 正在重连

#### 主显示区域
- **蓝色边框文本**: 最终识别结果（确定的文字）
- **橙色边框文本**: 预览文本（可能会变化）

#### 底部控制区
- **清空文本**: 清除所有显示的文字
- **保存文本**: 将当前文字保存为txt文件
- **重新连接**: 手动重新连接WebSocket

### 快捷键操作

- **Ctrl + L**: 清空文本
- **Ctrl + S**: 保存文本
- **Ctrl + R**: 重新连接

### 连接状态说明

| 状态 | 说明 | 解决方法 |
|------|------|----------|
| 已连接 | 正常工作状态 | 无需操作 |
| 连接中 | 正在建立连接 | 等待连接完成 |
| 连接断开 | WebSocket服务器未运行 | 启动WebSocket服务器 |
| 重连中 | 自动尝试重新连接 | 等待或手动重连 |
| 连接失败 | 多次重连失败 | 检查服务器状态 |

## 常见问题解决

### Q1: 前端页面显示"连接失败"

**可能原因：**
- WebSocket服务器未启动
- 端口被占用
- 防火墙阻止连接

**解决方法：**
1. 确保WebSocket服务器正在运行
2. 检查端口8765是否被占用
3. 临时关闭防火墙测试

### Q2: 有声音但前端没有显示文字

**可能原因：**
- ASR程序未启动
- UDP端口6009被占用
- ASR程序没有识别到语音

**解决方法：**
1. 启动ASR程序 `python src/asr/streaming_paraformer.py`
2. 检查麦克风是否正常工作
3. 确保说话声音足够大

### Q3: 页面显示乱码

**可能原因：**
- 编码问题
- 浏览器不支持UTF-8

**解决方法：**
1. 使用现代浏览器（Chrome、Firefox、Edge）
2. 确保浏览器编码设置为UTF-8

### Q4: 文本显示不完整

**可能原因：**
- 网络延迟
- WebSocket连接不稳定

**解决方法：**
1. 检查网络连接
2. 点击"重新连接"按钮
3. 刷新页面

## 高级配置

### 修改端口

如需修改端口，请同时修改以下文件：

**UDP端口（默认6009）：**
- `src/asr/streaming_paraformer.py` 第27行
- `src/websocket_server.py` 第15行

**WebSocket端口（默认8765）：**
- `src/websocket_server.py` 第15行
- `frontend/index.html` 第95行

### 自定义样式

修改 `frontend/style.css` 可以自定义界面外观：
- 颜色主题
- 字体大小
- 布局样式

### 性能优化

**ASR程序优化：**
- 调整 `chunk_size` 参数
- 修改 `pre_expect` 值

**前端优化：**
- 关闭不必要的浏览器标签
- 使用性能较好的浏览器

## 开发调试

### 查看日志

**WebSocket服务器日志：**
```bash
python src/websocket_server.py
```

**浏览器控制台：**
- 按F12打开开发者工具
- 查看Console标签页

### 调试WebSocket连接

在浏览器控制台中输入：
```javascript
// 查看连接状态
console.log(client.ws.readyState);

// 手动发送消息
client.ws.send(JSON.stringify({type: "ping"}));
```

### 测试UDP连接

```python
import socket
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.sendto("测试消息".encode('utf-8'), ('127.0.0.1', 6009))
```

## 系统要求

- **操作系统**: Windows 10/11, macOS, Linux
- **Python**: 3.8+
- **浏览器**: Chrome 80+, Firefox 75+, Edge 80+
- **内存**: 至少2GB可用内存
- **网络**: 本地回环连接

## 技术支持

如遇到问题，请：
1. 查看本指南的常见问题部分
2. 检查控制台错误信息
3. 确认所有依赖已正确安装
4. 验证端口没有被占用

## 更新日志

- **v1.0.0**: 初始版本，支持基本的实时显示功能
- 支持WebSocket连接
- 支持文本保存
- 支持自动重连
- 响应式界面设计
